<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SOS ìƒíƒœíƒì •ë‹¨ : ê°•ë¶êµ¬ì˜ ì‚¬ë¼ì§„ ì¹œêµ¬ë“¤ì„ ì°¾ì•„ì„œ</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <style>
        /* =========================================
           1. ì „ì²´ ë””ìì¸ (Dark Theme)
           ========================================= */
        :root {
            --primary-color: #00ff9d;
            --bg-color: #1a1a2e;
            --card-color: #252540;
            --text-color: #ffffff;
            --accent-ep1: #ffd700;
            --accent-ep2: #00b09b;
            --accent-ep3: #ff6b6b;
            --accent-ep4: #f4a261;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            padding: 0;
            background-color: #0f0f1a;
            color: var(--text-color);
            font-family: 'Pretendard', 'Malgun Gothic', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        #game-wrapper {
            width: 100%;
            max-width: 600px;
            background-color: var(--bg-color);
            height: 100vh;
            position: relative;
            box-shadow: 0 0 40px rgba(0,0,0,0.6);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            scroll-behavior: smooth;
        }
        
        #game-wrapper::-webkit-scrollbar { display: none; }
        #game-wrapper { -ms-overflow-style: none; scrollbar-width: none; }

        /* ì»¤ìŠ¤í…€ ëª¨ë‹¬ (Alert ëŒ€ì²´) */
        #custom-modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: #fff;
            color: #333;
            padding: 25px;
            border-radius: 15px;
            width: 85%;
            max-width: 320px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.4);
            animation: popIn 0.2s ease-out;
        }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal-text { font-size: 1.1rem; line-height: 1.5; margin-bottom: 20px; word-break: keep-all; }
        .modal-btn {
            background: var(--primary-color);
            color: #000;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.2s;
        }
        .modal-btn:active { transform: scale(0.95); }

        /* ê° ì„¹ì…˜ */
        .game-section {
            display: none;
            width: 100%;
            min-height: 100%;
            position: absolute;
            top: 0; left: 0;
            background-color: var(--bg-color);
            z-index: 10;
            flex-direction: column;
            padding-bottom: 80px;
        }
        .game-section.active { display: flex; position: relative; }

        /* ì¥ë©´ (ëˆ„ì í˜•) */
        .scene {
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            width: 100%;
            height: auto;
            border-bottom: 1px dashed rgba(255,255,255,0.1);
            animation: fadeIn 0.6s ease-out;
        }
        .scene.active { display: flex; }
        .scene.finished { opacity: 0.6; pointer-events: none; filter: grayscale(0.3); }

        /* UI ìš”ì†Œ */
        h2 {
            text-align: center; color: var(--primary-color); margin-bottom: 15px;
            font-size: 1.3rem; text-shadow: 0 2px 4px rgba(0,0,0,0.5); width: 100%; flex-shrink: 0;
        }

        .story-text {
            background: rgba(255, 255, 255, 0.08); padding: 15px; border-radius: 12px;
            line-height: 1.6; margin-bottom: 20px; border-left: 4px solid var(--primary-color);
            font-size: 1rem; word-break: keep-all; width: 100%; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .dialogue { font-style: italic; color: #dcdcdc; margin-top: 10px; display: block; font-weight: bold; }

        /* ê¸°ë³¸ ì´ë¯¸ì§€ ë°•ìŠ¤ (1:1 ì •ì‚¬ê°í˜•) */
        .img-box {
            width: 100%; aspect-ratio: 1 / 1; background-color: #000; border-radius: 12px;
            margin-bottom: 20px; display: flex; justify-content: center; align-items: center;
            overflow: hidden; border: 2px solid #444; flex-shrink: 0;
        }
        .img-box img { width: 100%; height: 100%; object-fit: cover; }

        /* ë²„íŠ¼ */
        .btn {
            background: linear-gradient(135deg, #00b09b, #96c93d); border: none; padding: 15px 0;
            color: white; font-size: 1.1rem; font-weight: bold; border-radius: 30px; cursor: pointer;
            width: 100%; margin-top: auto; margin-bottom: 10px; box-shadow: 0 4px 15px rgba(0, 255, 150, 0.3);
            transition: 0.2s; flex-shrink: 0;
        }
        .btn:active { transform: scale(0.98); }
        .btn:disabled, .btn.disabled { background: #555; color: #aaa; cursor: default; box-shadow: none; }

        input[type="text"], input[type="number"] {
            width: 100%; padding: 15px; font-size: 1.1rem; text-align: center; border-radius: 10px;
            border: 2px solid #555; background: #222; color: white; margin-bottom: 20px; flex-shrink: 0;
        }

        .choice-btn {
            background: #333; color: #fff; border: 1px solid #555; padding: 15px; width: 100%; text-align: left;
            border-radius: 10px; margin-bottom: 10px; cursor: pointer; transition: 0.2s; font-size: 1rem; flex-shrink: 0;
        }
        .choice-btn:hover { background: #444; border-color: var(--primary-color); }

        /* ë¡œë¹„ */
        .door-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; margin-bottom: 20px; flex-shrink: 0; }
        .door-card {
            background-color: var(--card-color); border: 2px solid #555; border-radius: 15px;
            padding: 15px; text-align: center; cursor: pointer; height: 140px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .door-card.cleared { opacity: 0.5; border-color: #444; background: #111; pointer-events: none; filter: grayscale(100%); position: relative; }
        .door-card.cleared::after {
            content: "âœ… í•´ê²° ì™„ë£Œ"; position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg); border: 3px solid #00ff9d; color: #00ff9d;
            padding: 5px 10px; font-weight: bold; background: rgba(0,0,0,0.9); font-size: 1rem; white-space: nowrap;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }
        .shake { animation: shake 0.4s ease-in-out; }

        /* === íŠ¹ìˆ˜ ë¯¸ì…˜ ìŠ¤íƒ€ì¼ === */
        /* EP1 M1: í‹€ë¦°ê·¸ë¦¼ì°¾ê¸° (1768x2296 ë¹„ìœ¨) */
        .hidden-catch-container { position: relative; width: 100%; aspect-ratio: 1768 / 2296; margin: 0 auto; flex-shrink: 0; }
        /* ë„¤ëª¨ ì˜ì—­ (ìˆ˜ì •ë¨: íŒŒë€ìƒ‰) */
        .hidden-catch-zone { 
            position: absolute; 
            border: 2px solid transparent; 
            cursor: pointer; 
            background: transparent;
        }
        /* í´ë¦­ ì‹œ íŒŒë€ìƒ‰ í‘œì‹œ */
        .found-marker { 
            position: absolute; 
            border: 3px solid #0055ff; 
            background: rgba(0, 85, 255, 0.3); 
            box-shadow: 0 0 10px #0055ff; 
            pointer-events: none; 
            display: none; 
        }

        /* EP2 M1: ë¶„ë¦¬ìˆ˜ê±° */
        .trash-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 100%; margin-bottom: 20px; flex-shrink: 0; }
        .trash-item { background: #444; padding: 10px 5px; border-radius: 8px; text-align: center; font-size: 0.9rem; cursor: pointer; border: 2px solid transparent; }
        .trash-item.selected { border-color: var(--accent-ep2); background: #222; color: var(--accent-ep2); font-weight: bold; }

        /* EP2 M3: ê¸€ì ë¸”ë¡ */
        .word-block-container { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; }
        .word-block { 
            width: 60px; height: 60px; background: #444; border: 2px solid #777; border-radius: 10px;
            color: white; font-size: 1.5rem; display: flex; justify-content: center; align-items: center; cursor: pointer;
        }
        #bridge-display {
            width: 80%; height: 50px; border-bottom: 4px solid #00ff9d; color: #00ff9d;
            font-size: 2rem; text-align: center; margin: 0 auto 20px; letter-spacing: 5px;
        }
        .bridge-btn-group { display: flex; gap: 10px; width: 100%; justify-content: center; } 

        /* EP2 M4: ë„ˆêµ¬ë¦¬ í–‰ë™ */
        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; margin-bottom: 20px; flex-shrink: 0; }
        .action-btn { background: #333; color: white; border: 1px solid #555; padding: 15px; border-radius: 10px; cursor: pointer; display: flex; flex-direction: column; align-items: center; }
        #raccoon-status { width: 80px; height: 80px; border-radius: 50%; background: #ff4444; margin: 0 auto 15px; display: flex; justify-content: center; align-items: center; font-size: 2.5rem; }
        #raccoon-status.green { background: #00cc00; }

        /* EP3 M2: ë¦¬ë“¬ ê²Œì„ */
        .memory-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; width: 100%; max-width: 350px; margin: 0 auto 20px; flex-shrink: 0; }
        .memory-hole { aspect-ratio: 1; background: #5d4037; border-radius: 50%; border: 3px solid #3e2723; cursor: pointer; display: flex; justify-content: center; align-items: center; font-weight: bold; color: rgba(255,255,255,0.3); font-size: 1.2rem; }
        .memory-hole.active { background: #ffeb3b; color: #000; box-shadow: 0 0 15px #ffeb3b; transform: scale(1.1); }

        /* EP3 M3: ì•”í˜¸í‘œ (1~20 ëœë¤ ì„ì„) */
        .code-table { 
            display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; 
            background: #f4e1d2; color: #3e2723; padding: 10px; border-radius: 5px; 
            margin-bottom: 15px; font-family: 'Courier New', monospace; font-size: 0.85rem; flex-shrink: 0;
        }
        .code-item { border: 1px dashed #a1887f; padding: 5px 2px; text-align: center; background:rgba(255,255,255,0.3); }

        /* EP4 M2: ë°œìêµ­ ì¶”ì  (980x980) */
        .ep4-maze-img { width: 100%; aspect-ratio: 980/980; object-fit: contain; border-radius: 10px; margin-bottom: 15px; }

        /* EP4 M3: ë¡œë“œí‚¬ (ë„ë¡œ ë„“íˆê³  êµì°¨ ì£¼í–‰) */
        .road-scene { 
            width: 100%; height: 380px; background: #333; position: relative; overflow: hidden; 
            border-radius: 10px; border-left: 3px dashed #fff; border-right: 3px dashed #fff; margin-bottom: 20px; flex-shrink: 0; 
        }
        .center-line { position: absolute; top: 50%; width: 100%; height: 2px; background: #fff; border-bottom: 2px dashed #333; }
        .player-salk { position: absolute; font-size: 2.5rem; left: 50%; transform: translateX(-50%); transition: top 0.2s; z-index: 10; }
        .enemy-car { position: absolute; width: 80px; height: 50px; font-size: 2.5rem; display: flex; justify-content: center; align-items: center; }
        
        /* ìë™ì°¨ ìœ„ì¹˜ ë° ë°©í–¥ ìˆ˜ì • */
        .car-top { transform: scaleX(1); top: 100px; } /* ìœ„ìª½ ì°¨ì„ , ë¹¨ê°„ì°¨ */
        .car-bottom { transform: scaleX(-1); top: 240px; } /* ì•„ë˜ìª½ ì°¨ì„ , íŒŒë€ì°¨ */
        
        .safe-zone-end { position:absolute; bottom:0; width:100%; height:50px; background:rgba(0,255,0,0.3); border-top:2px solid #0f0; display:flex; justify-content:center; align-items:center; color:#0f0; font-weight:bold; }

        /* EP4 M4: ë¨¹ì´ì‚¬ìŠ¬ */
        .piece-container { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-bottom: 20px; flex-shrink: 0; width: 100%; }
        .puzzle-piece { width: 60px; height: 60px; background-color: #3e3e5e; border: 2px solid #fff; border-radius: 5px; cursor: pointer; display: flex; flex-direction: column; justify-content: center; align-items: center; font-size: 0.8rem; }
        .puzzle-piece.selected { border-color: #f4a261; background-color: #f4a261; color: #000; }
        .pyramid-container { display: flex; flex-direction: column; gap: 5px; width: 100%; align-items: center; margin-bottom: 20px; flex-shrink: 0; }
        .puzzle-slot { width: 100%; max-width: 250px; height: 40px; border: 2px dashed #aaa; border-radius: 5px; display: flex; justify-content: center; align-items: center; font-size: 0.9rem; color: #aaa; background: rgba(255,255,255,0.05); cursor: pointer; }
        .puzzle-slot.filled { border-style: solid; border-color: #f4a261; background-color: #5d4037; color: #fff; font-weight: bold; }

        /* ì—”ë”©: ìŠ¤í”„ë§ ë…¸íŠ¸ */
        .spring-note {
            background: #fdf5e6; color: #333; padding: 15px 20px; border-radius: 5px;
            position: relative; margin: 10px auto; display: inline-block;
            font-family: 'Gungsuh', serif; font-weight: bold; font-size: 1.5rem;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
        }
        .spring-note::before {
            content: ""; position: absolute; top: -10px; left: 10px; right: 10px; height: 10px;
            background: repeating-linear-gradient(90deg, #333 0, #333 2px, transparent 2px, transparent 15px);
        }

        /* í­ì£½ íš¨ê³¼ (Canvas) */
        #confetti-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; }

    </style>
</head>
<body>
    <!-- ì»¤ìŠ¤í…€ ëª¨ë‹¬ -->
    <div id="custom-modal">
        <div class="modal-content">
            <p id="modal-text" class="modal-text">ì•Œë¦¼ ë‚´ìš©</p>
            <button class="modal-btn" onclick="GameUI.closeModal()">í™•ì¸</button>
        </div>
    </div>

    <canvas id="confetti-canvas"></canvas>
    <div id="game-wrapper">
        <audio id="bgm-main" loop></audio>

        <!-- #################### ì¸íŠ¸ë¡œ #################### -->
        <div id="section-intro" class="game-section active">
            <div class="scene active" id="intro-1">
                <h2>#1. ë‚˜ë¥¸í•œ ì˜¤í›„</h2>
                <div class="img-box">
                    <img src="img/1.ì¸íŠ¸ë¡œ 1ë²ˆ.jpg" alt="ì´ë¶ˆ ì† ì£¼ì¸ê³µ">
                </div>
                <div class="story-text">
                    ì°½ë¬¸ ë°–ìœ¼ë¡œ ë”°ìŠ¤í•œ í–‡ì‚´ì´ ìŸì•„ì§€ëŠ” ê¸ˆìš”ì¼ ì˜¤í›„.<br>
                    í•™êµì—ì„œ ëŒì•„ì˜¨ ë‚˜ëŠ” ì™ ì§€ ëª¨ë¥´ê²Œ ëª¸ì— ê¸°ìš´ì´ ì—†ì—ˆë‹¤.<br>
                    'ë¶ê·¹ê³°ì´ ë¶ˆìŒí•˜ê¸´ í•œë°... ë‚´ê°€ ì‚¬ëŠ” ì„œìš¸ ê°•ë¶êµ¬ë‘ì€ ìƒê´€ì—†ëŠ” ì¼ì´ì–ì•„.'<br>
                    ë‚˜ëŠ” ë”°ëœ»í•œ ì´ë¶ˆ ì†ì— íŒŒê³ ë“¤ì–´ ëˆˆì„ ê°ì•˜ë‹¤.
                </div>
                <button class="btn" onclick="SceneManager.next('intro', 1)">ì ì— ë¹ ì ¸ë“ ë‹¤...</button>
            </div>

            <div class="scene" id="intro-2">
                <h2>#2. íšŒìƒ‰ë¹› ì•ˆê°œ ì†</h2>
                <div class="img-box">
                    <img src="img/1.ì¸íŠ¸ë¡œ 2ë²ˆ.jpg" alt="íšŒìƒ‰ë¹› ë„ì‹œ">
                </div>
                <div class="story-text">
                    "...ë„ì™€ì¤˜... ì œë°œ..."<br><br>
                    ë‹¤ê¸‰í•œ ëª©ì†Œë¦¬ì— ëˆˆì„ ë–´ë‹¤. ë‚´ ë°©ì€ ì‚¬ë¼ì§€ê³  ì§™ì€ íšŒìƒ‰ ì•ˆê°œë¿ì´ì—ˆë‹¤.<br>
                    ì°½ë°– ë¶í•œì‚°ì€ ì¿ë¹› ë¨¼ì§€ì— ë’¤ë®ì—¬ ì‹ ìŒí•˜ê³  ìˆì—ˆê³ , ìš°ì´ì²œì€ ê²€ì€ ë¬¼ì´ ë˜ì–´ íë¥´ê³  ìˆì—ˆë‹¤.
                </div>
                <button class="btn" onclick="SceneManager.next('intro', 2)">ì£¼ë³€ì„ ì‚´í´ë³¸ë‹¤</button>
            </div>

            <div class="scene" id="intro-3">
                <h2>#3. ê·¸ë¦¼ìì˜ ê²½ê³ </h2>
                <div class="img-box">
                    <img src="img/1.ì¸íŠ¸ë¡œ 3ë²ˆ.jpg" alt="4ê°œì˜ ê·¸ë¦¼ì">
                </div>
                <div class="story-text">
                    ì•ˆê°œ ì†ì—ì„œ íë¦¿í•œ ë„¤ ê°œì˜ ê·¸ë¦¼ìê°€ ë‚˜íƒ€ë‚¬ë‹¤.<br>
                    "ë„Œ ìš°ë¦¬ê°€ ë¨¼ ê³³ì—ë§Œ ìˆë‹¤ê³  ìƒê°í–ˆì§€?<br>
                    ìš°ë¦¬ëŠ” ë°”ë¡œ ì—¬ê¸°, ë„¤ê°€ ì‚¬ëŠ” ê°•ë¶êµ¬ ê³³ê³³ì— ìˆì–´.<br>
                    í•˜ì§€ë§Œ ì´ì œëŠ” ìˆ¨ì„ ì‰´ ìˆ˜ê°€ ì—†ì–´..."<br><br>
                    ê·¸ë¦¼ìë“¤ì´ ì‚¬ë¼ì§„ ë’¤, ì£¼ë¨¸ë‹ˆ ì†ì—ì„œ ìŠ¤ë§ˆíŠ¸í° ì§„ë™ì´ ìš¸ë ¸ë‹¤.
                </div>
                <button class="btn" onclick="SceneManager.next('intro', 3)">ìŠ¤ë§ˆíŠ¸í° í™•ì¸í•˜ê¸°</button>
            </div>

            <div class="scene" id="intro-4">
                <h2>#4. ë¯¸ì…˜ì˜ ì‹œì‘</h2>
                <div class="img-box">
                    <img src="img/1.ì¸íŠ¸ë¡œ 4ë²ˆ.jpg" alt="ì•± ì‹¤í–‰">
                </div>
                <div class="story-text">
                    <strong>[ê¸´ê¸‰ ì˜ë¢°]</strong><br>
                    "ìš°ë¦¬ì˜ ì´ë¦„ê³¼ ëª¨ìŠµì„ ê¸°ì–µí•´ ì¤˜.<br>
                    ë„¤ê°€ ë¶ˆëŸ¬ì£¼ì§€ ì•Šìœ¼ë©´, ìš°ë¦¬ëŠ” ì˜ì˜ ì‚¬ë¼ì§€ê²Œ ë  ê±°ì•¼."<br><br>
                    ìŠ¤ë§ˆíŠ¸í°ì´ ìš¸ë¦¬ë©° &lt;SOS ìƒíƒœíƒì •ë‹¨&gt; ì•±ì´ ì¼œì¡Œë‹¤.
                </div>
                <button class="btn" onclick="GameSystem.goToLobby()">ìƒíƒœíƒì •ë‹¨ ì¶œë™!</button>
            </div>
        </div>

        <!-- #################### ë¡œë¹„ #################### -->
        <div id="section-lobby" class="game-section">
            <div class="scene active">
                <h2>ğŸ•µï¸ íƒì • ë³¸ë¶€</h2>
                <div class="story-text" style="text-align:center;">
                    íšŒìƒ‰ ì•ˆê°œê°€ ê±·íˆë©° 4ê°œì˜ ë¬¸ì´ ë‚˜íƒ€ë‚¬ë‹¤.<br>
                    êµ¬ì¶œí•  ì¹œêµ¬ë¥¼ ì„ íƒí•´ë¼!
                </div>
                <div class="door-grid">
                    <div class="door-card" id="door-1" onclick="GameSystem.startEpisode(1)" style="border-color: var(--accent-ep1);">
                        <span class="door-icon">ğŸŒ¼</span>
                        <div class="door-title">EP1. ë…¸ë€ ì˜·ì˜ ë¶ˆì²­ê°<br>(ë¶í•œì‚°)</div>
                    </div>
                    <div class="door-card" id="door-2" onclick="GameSystem.startEpisode(2)" style="border-color: var(--accent-ep2);">
                        <span class="door-icon">ğŸƒ</span>
                        <div class="door-title">EP2. ë°¤ê±°ë¦¬ì˜ ê·¸ë¦¼ì<br>(ìš°ì´ì²œ)</div>
                    </div>
                    <div class="door-card" id="door-3" onclick="GameSystem.startEpisode(3)" style="border-color: var(--accent-ep3);">
                        <span class="door-icon">ğŸ¥</span>
                        <div class="door-title">EP3. ìœ„ê¸°ì˜ ê±´ì¶•ê°€<br>(ìˆ²ì†)</div>
                    </div>
                    <div class="door-card" id="door-4" onclick="GameSystem.startEpisode(4)" style="border-color: var(--accent-ep4);">
                        <span class="door-icon">ğŸ†</span>
                        <div class="door-title">EP4. ìœ ë ¹ ì‚¬ëƒ¥ê¾¼<br>(ìš°ì´ë ¹ê¸¸)</div>
                    </div>
                </div>
                <button id="final-btn" class="btn" style="display:none; background:linear-gradient(45deg, #ff00cc, #333399);" onclick="GameSystem.goToEnding()">
                    âœ¨ ê¿ˆì—ì„œ ê¹¨ì–´ë‚˜ê¸° (íˆë“  ì—”ë”©) âœ¨
                </button>
            </div>
        </div>

        <!-- #################### EP1 ì‚°ê°œë‚˜ë¦¬ #################### -->
        <div id="section-ep1" class="game-section">
            <div class="scene active" id="ep1-1">
                <h2 style="color:var(--accent-ep1)">EP1. ì™¸ë¡œìš´ ë…¸ë€ ë³„</h2>
                <div class="img-box">
                    <img src="img/2.ì‚°ê°œë‚˜ë¦¬ 1ë²ˆ.jpg" alt="ì‚°ê°œë‚˜ë¦¬">
                </div>
                <div class="story-text">
                    ë¹½ë¹½í•œ ì†Œë‚˜ë¬´ ìˆ² ë°”ìœ„ í‹ˆì—ì„œ ê°€ëŠë‹¤ë€ ëª©ì†Œë¦¬ê°€ ë“¤ë ¤ì™”ë‹¤.<br>
                    "ê±°ê¸° ëˆ„êµ¬ë‹ˆ...? ë‚´ ëª©ì†Œë¦¬ê°€ ë“¤ë ¤?"
                </div>
                <button class="btn" onclick="SceneManager.next('ep1', 1)">ì†Œë¦¬ì˜ ì •ì²´ í™•ì¸í•˜ê¸°</button>
            </div>

            <!-- M1: í‹€ë¦°ê·¸ë¦¼ì°¾ê¸° (íŒŒë€ ë„¤ëª¨, ì˜ì—­ í™•ëŒ€) -->
            <div class="scene" id="ep1-2">
                <h2 style="color:var(--accent-ep1)">M1. ê°€ì§œ ê°œë‚˜ë¦¬ë¥¼ ì°¾ì•„ë¼!</h2>
                <div class="story-text">
                    "ë‚˜ëŠ” ë™ë„¤ ê³µì›ì˜ ê°œë‚˜ë¦¬ì™€ëŠ” ë‹¬ë¼."<br>
                    í™”ë©´ì—ì„œ <strong>íŠ¹ì§• 3ê°€ì§€</strong>ë¥¼ ëª¨ë‘ ì°¾ì•„ ëˆŒëŸ¬ì¤˜!
                </div>
                <div class="hidden-catch-container">
                    <img src="img/2.ì‚°ê°œë‚˜ë¦¬ 2ë²ˆ.jpg" style="width:100%; height:100%; object-fit:cover; border-radius:10px;">
                    <!-- ì •ë‹µ ì˜ì—­ (ë„¤ëª¨, ë” í¬ê²Œ) -->
                    <!-- ì™¼ìª½ ìƒë‹¨ -->
                    <div class="hidden-catch-zone" style="top:20%; left:5%; width:30%; height:25%;" onclick="Ep1Game.catchItem(this)"></div>
                    <div class="found-marker" style="top:20%; left:5%; width:30%; height:25%;"></div>

                    <!-- ì™¼ìª½ í•˜ë‹¨ -->
                    <div class="hidden-catch-zone" style="bottom:5%; left:5%; width:30%; height:25%;" onclick="Ep1Game.catchItem(this)"></div>
                    <div class="found-marker" style="bottom:5%; left:5%; width:30%; height:25%;"></div>

                    <!-- ì˜¤ë¥¸ìª½ í•˜ë‹¨ -->
                    <div class="hidden-catch-zone" style="bottom:5%; right:5%; width:35%; height:25%;" onclick="Ep1Game.catchItem(this)"></div>
                    <div class="found-marker" style="bottom:5%; right:5%; width:35%; height:25%;"></div>
                </div>
                <p id="ep1-cnt" style="color:var(--accent-ep1); font-weight:bold; margin-top:10px;">ì°¾ì€ íŠ¹ì§•: 0 / 3</p>
                <button id="ep1-btn-2" class="btn" style="display:none;" onclick="SceneManager.next('ep1', 2)">ì •ì²´ í™•ì¸ ì™„ë£Œ!</button>
            </div>

            <div class="scene" id="ep1-3">
                <h2 style="color:var(--accent-ep1)">M2. ì´ˆë¡ ê±°ì¸ì˜ ì •ì²´</h2>
                <div class="img-box">
                    <img src="img/2.ì‚°ê°œë‚˜ë¦¬ 3ë²ˆ.jpg" alt="ìš”ì •">
                </div>
                <div class="story-text">
                    "ë§ì•„, ë‚˜ëŠ” ë¶í•œì‚° ê¹ƒëŒ€ì¢… ì‚°ê°œë‚˜ë¦¬ì•¼.<br>
                    ì´ ë‚˜ë¬´ë“¤ì´ ë„ˆë¬´ ë¹½ë¹½í•´ì„œ í–‡ë¹›ì„ ë§‰ê³  ìˆì–´.<br>
                    ì¤„ê¸°ì— í„¸ ê°™ì€ ì‹¹ì´ ë‚œ ì´ ë‚˜ë¬´ì˜ ì´ë¦„ì€?"<br>
                    (ì´ˆì„± íŒíŠ¸: ã„¹ã„±ã„· ì†Œë‚˜ë¬´)
                </div>
                <input type="text" id="ep1-input-1" placeholder="ì •ë‹µ ì…ë ¥">
                <button class="btn" onclick="Ep1Game.checkAnswer1()">í™•ì¸</button>
            </div>

            <div class="scene" id="ep1-4">
                <h2 style="color:var(--accent-ep1)">M3. ìš°ë¦¬ëŠ” ì§ê¿ì´ í•„ìš”í•´</h2>
                <div class="story-text">
                    "í–‡ë¹› ë•ë¶„ì— í˜ì´ ë‚˜! í•˜ì§€ë§Œ ì—¬ì „íˆ ì”¨ì•—ì„ ë§ºì„ ìˆ˜ê°€ ì—†ì–´.<br>
                    ì´ê³³ ê°€ì¡±ë“¤ì€ ë‚˜ì™€ ìœ ì „ìê°€ ë˜‘ê°™ê±°ë“ .<br>
                    <strong>ë‹¤ë¥¸ ì‚°ì— ì‚¬ëŠ” ì¹œêµ¬</strong>ë¥¼ ì†Œê°œí•´ ì¤˜!"
                </div>
                <button class="choice-btn" onclick="GameUI.modal('ê±°ê¸´ ë„ˆë¬´ ê°€ê¹Œì›Œ! ìš°ë¦¬ë‘ ìœ ì „ìê°€ ë¹„ìŠ·í•  ê±°ì•¼.')">1. ë°”ë¡œ ì˜† ë¶í•œì‚° ì¹œêµ¬</button>
                <button class="choice-btn" onclick="GameUI.modal('ë”©ë™ëŒ•! ë©€ë¦¬ ë–¨ì–´ì§„ ì¹œêµ¬ì™€ ë§Œë‚˜ì•¼ ê±´ê°•í•œ ì”¨ì•—ì´ ìƒê²¨.'); SceneManager.next('ep1', 4);">2. ë©€ë¦¬ ë–¨ì–´ì§„ ê´€ì•…ì‚° ì¹œêµ¬</button>
            </div>

            <div class="scene" id="ep1-5">
                <h2 style="color:var(--accent-ep1)">M4. ìš°ë¦¬ëŠ” ì™œ ì•½í•´ì¡Œì„ê¹Œ?</h2>
                <div class="story-text">
                    "ì™€! ìƒˆë¡œìš´ ì¹œêµ¬ë¥¼ ë§Œë‚˜ë‹ˆ ê±´ê°•í•œ ì”¨ì•—ì´ ìƒê²¼ì–´.<br>
                    <strong>ìƒê¹€ìƒˆì™€ ì„±ì§ˆì´ ì„œë¡œ ë‹¤ì–‘í•œ ì •ë„</strong>ë¥¼ ëœ»í•˜ëŠ” ì´ê²ƒì€?"<br>
                    (ì´ˆì„±: ã……ã…ã„·ã…‡ã……)
                </div>
                <input type="text" id="ep1-input-2" placeholder="ë‹¤ì„¯ ê¸€ì ì…ë ¥">
                <button class="btn" onclick="Ep1Game.checkAnswer2()">ì •ë‹µ í™•ì¸</button>
            </div>

            <div class="scene" id="ep1-6">
                <h2 style="color:var(--accent-ep1)">Final. ë‹¤ì–‘ì„±ì˜ ì”¨ì•—</h2>
                <div class="story-text">
                    "ìš°ë¦¬ê°€ ë‹¤ì‹œ ìˆ²ì˜ ë³„ì´ ë  ìˆ˜ ìˆë„ë¡ ë§ˆì§€ë§‰ ì£¼ë¬¸ì„ ì™¸ì³ì¤˜!"<br><br>
                    <strong>[ì•”í˜¸í‘œ]</strong><br>
                    â™¥=ì–‘ / â˜…=ë‹¤ / â™ =ì•¼ / â—†=ê°• / â™£=í•´<br><br>
                    ì£¼ë¬¸: <strong>"â˜… â™¥ â™£ â™  â—† í•˜ë‹¤"</strong>
                </div>
                <input type="text" id="ep1-input-3" placeholder="ë¬¸ì¥ ì™„ì„±í•˜ê¸°">
                <button class="btn" onclick="Ep1Game.checkAnswer3()">ì£¼ë¬¸ ì™¸ì¹˜ê¸°</button>
            </div>

            <div class="scene" id="ep1-7">
                <h2 style="color:var(--accent-ep1)">ğŸ‰ ì—í”¼ì†Œë“œ 1 í´ë¦¬ì–´!</h2>
                <div class="img-box">
                    <img src="img/2.ì‚°ê°œë‚˜ë¦¬ 4ë²ˆ.jpg" alt="í™©ê¸ˆì”¨ì•—">
                </div>
                <div class="story-text">
                    ìˆ² ì „ì²´ê°€ í™˜í•˜ê²Œ ë¹›ë‚˜ë©° ì‚°ê°œë‚˜ë¦¬ ìš”ì •ë“¤ì´ ì¶¤ì„ ì¶”ì—ˆë‹¤.<br>
                    ë‚´ ì†ì—ëŠ” <strong>[í™©ê¸ˆë¹› ì‚°ê°œë‚˜ë¦¬ ì”¨ì•—]</strong>ì´ ì¥ì–´ì ¸ ìˆì—ˆë‹¤.
                </div>
                <button class="btn" onclick="GameSystem.clearEpisode(1)">ë³¸ë¶€ë¡œ ë³µê·€</button>
            </div>
        </div>

        <!-- #################### EP2 ë„ˆêµ¬ë¦¬ #################### -->
        <div id="section-ep2" class="game-section">
            <div class="scene active" id="ep2-1">
                <h2 style="color:var(--accent-ep2)">EP2. ë°¤ì„ ê±·ëŠ” ê·¸ë¦¼ì</h2>
                <div class="img-box">
                    <img src="img/3.ë„ˆêµ¬ë¦¬ 1ë²ˆ.jpg" alt="ì•„í”ˆ ë„ˆêµ¬ë¦¬">
                </div>
                <div class="story-text">
                    ì–´ë‘ìš´ ë°¤, ì“°ë ˆê¸° ë”ë¯¸ ì˜†ì—ì„œ ì‹ ìŒ ì†Œë¦¬ê°€ ë“¤ë¦°ë‹¤.<br>
                    "ìœ¼... ë°° ì•„íŒŒ... ì‚¬ëŒë“¤ì´ ë‚¨ê¸´ ìŒì‹ì„ ë¨¹ì—ˆë”ë‹ˆ..."
                </div>
                <button class="btn" onclick="SceneManager.next('ep2', 1)">ì¹˜ë£Œí•˜ëŸ¬ ê°€ê¸°</button>
            </div>

            <div class="scene" id="ep2-2">
                <h2 style="color:var(--accent-ep2)">M1. ì˜¬ë°”ë¥¸ ë¶„ë¦¬ë°°ì¶œ</h2>
                <div class="story-text">
                    ë„ˆêµ¬ë¦¬ê°€ ì“°ë ˆê¸°ë¥¼ ë¨¹ì§€ ëª»í•˜ê²Œ <strong>ì¬í™œìš© ê°€ëŠ¥í•œ ê²ƒ 4ê°œ</strong>ë¥¼ ì¹˜ì›Œì¤˜!
                </div>
                <div class="trash-grid">
                    <div class="trash-item" data-v="o" onclick="Ep2Game.toggleTrash(this)">ê¹¨ë—í•œ<br>í˜íŠ¸ë³‘</div>
                    <div class="trash-item" data-v="x" onclick="Ep2Game.toggleTrash(this)">ì–‘ë… ë¬»ì€<br>ì»µë¼ë©´</div>
                    <div class="trash-item" data-v="x" onclick="Ep2Game.toggleTrash(this)">ì¹˜í‚¨ ë¼ˆ</div>
                    <div class="trash-item" data-v="o" onclick="Ep2Game.toggleTrash(this)">ì•Œë£¨ë¯¸ëŠ„<br>ìº”</div>
                    <div class="trash-item" data-v="x" onclick="Ep2Game.toggleTrash(this)">ê¹¨ì§„ ìœ ë¦¬</div>
                    <div class="trash-item" data-v="o" onclick="Ep2Game.toggleTrash(this)">ì‹ ë¬¸ì§€</div>
                    <div class="trash-item" data-v="x" onclick="Ep2Game.toggleTrash(this)">ì˜ìˆ˜ì¦</div>
                    <div class="trash-item" data-v="o" onclick="Ep2Game.toggleTrash(this)">ìœ ë¦¬ë³‘</div>
                    <div class="trash-item" data-v="x" onclick="Ep2Game.toggleTrash(this)">ë‚˜ë¬´ì “ê°€ë½</div>
                </div>
                <button class="btn" onclick="Ep2Game.submitTrash()">ë¶„ë¦¬ë°°ì¶œ í•˜ê¸° â™»ï¸</button>
            </div>

            <div class="scene" id="ep2-3">
                <h2 style="color:var(--accent-ep2)">M2. ë²”ì¸ì€ ëˆ„êµ¬ì¼ê¹Œ?</h2>
                <div class="story-text">
                    "ê³ ë§ˆì›Œ! ì‚¬ëŒë“¤ì´ ìê¾¸ ë‚˜ë¥¼ ê³ ì–‘ì´ë‚˜ ë¼ì¿¤ì´ë¼ê³  í•´.<br>
                    <strong>ë‚´ ì§„ì§œ ë°œìêµ­(ë„ˆêµ¬ë¦¬)</strong>ì„ ì°¾ì•„ì¤˜!"
                </div>
                <button class="choice-btn" onclick="GameUI.modal('ë°œí†± ìêµ­ì´ ì—†ì–ì•„! ì´ê±´ ê³ ì–‘ì´ì•¼.')">A. ë™ê¸€ë™ê¸€ ë°œìêµ­ (ë°œí†± X)</button>
                <button class="choice-btn" onclick="GameUI.modal('ë°œê°€ë½ì´ 3ê°œë„¤? ì´ê±´ ìƒˆì•¼.')">B. ê°€ëŠ˜ê³  ê¸´ ë°œìêµ­</button>
                <button class="choice-btn" onclick="GameUI.modal('ë¬¼ê°ˆí€´ê°€ ìˆë„¤. ì´ê±´ ìˆ˜ë‹¬ì´ì•¼.')">C. ë¬¼ê°ˆí€´ ë°œìêµ­</button>
                <button class="choice-btn" onclick="GameUI.modal('ì •ë‹µì´ì•¼! ë„ˆêµ¬ë¦¬ëŠ” ë°œí†± ìêµ­ì´ ì„ ëª…í•´.'); SceneManager.next('ep2', 3);">D. ë°œí†±ì´ ì„ ëª…í•œ ë°œìêµ­ (ë°œê°€ë½ 4ê°œ)</button>
            </div>

            <!-- M3: ê¸€ì ë¸”ë¡ í´ë¦­ -->
            <div class="scene" id="ep2-4">
                <h2 style="color:var(--accent-ep2)">M3. ëŠì–´ì§„ ê¸¸ ì‡ê¸°</h2>
                <div class="img-box">
                     <img src="img/3.ë„ˆêµ¬ë¦¬ 2ë²ˆ.jpg" alt="ìƒíƒœí†µë¡œ">
                </div>
                <div class="story-text">
                    "ë„ë¡œê°€ ìˆ²ì„ ëŠì–´ë†¨ì–´. ë¡œë“œí‚¬ì„ ë‹¹í•˜ì§€ ì•Šê²Œ <strong>ì´ê²ƒ</strong>ì„ ê±´ì„¤í•´ ì¤˜.<br>
                    ê¸€ì ë¸”ë¡ì„ ìˆœì„œëŒ€ë¡œ ëˆŒëŸ¬ ë‹¤ë¦¬ë¥¼ ì™„ì„±í•´!"
                </div>
                <div id="bridge-display">____</div>
                <div class="word-block-container">
                    <div class="word-block" onclick="Ep2Game.addBridge('ë¡œ')">ë¡œ</div>
                    <div class="word-block" onclick="Ep2Game.addBridge('ìƒ')">ìƒ</div>
                    <div class="word-block" onclick="Ep2Game.addBridge('í†µ')">í†µ</div>
                    <div class="word-block" onclick="Ep2Game.addBridge('íƒœ')">íƒœ</div>
                </div>
                <div class="bridge-btn-group">
                    <button class="btn" style="width:48%;" onclick="Ep2Game.checkBridge()">ë‹¤ë¦¬ ê±´ì„¤</button>
                    <button class="btn" style="background:#555; width:48%;" onclick="Ep2Game.resetBridge()">ë‹¤ì‹œ ë†“ê¸°</button>
                </div>
            </div>

            <div class="scene" id="ep2-5">
                <h2 style="color:var(--accent-ep2)">M4. ë„ˆêµ¬ë¦¬ì˜ 'ë¹¨ê°„ë¶ˆ'</h2>
                <div id="raccoon-status">ğŸ¤¬</div>
                <div class="story-text" style="text-align:center;">
                    <strong>[ê²½ê³ ]</strong> ë„ˆêµ¬ë¦¬ê°€ ì”ëœ© ê²ì„ ë¨¹ì—ˆì–´ìš”.<br>
                    ë„ˆêµ¬ë¦¬ë¥¼ ì§„ì •ì‹œí‚¬ <strong>ì˜¬ë°”ë¥¸ í–‰ë™</strong>ì€?
                </div>
                <div class="action-grid">
                    <div class="action-btn" onclick="Ep2Game.checkAction(1)">ğŸ—<span>ë¨¹ì´ì£¼ê¸°</span></div>
                    <div class="action-btn" onclick="Ep2Game.checkAction(2)">ğŸ“¸<span>ì‚¬ì§„ì°ê¸°</span></div>
                    <div class="action-btn" onclick="Ep2Game.checkAction(3)">ğŸ‘‹<span>ì“°ë‹¤ë“¬ê¸°</span></div>
                    <div class="action-btn" onclick="Ep2Game.checkAction(4)">ğŸ‘£ğŸ”™<span>ë’·ê±¸ìŒì§ˆ</span></div>
                </div>
            </div>

            <div class="scene" id="ep2-6">
                <h2 style="color:var(--accent-ep2)">Final. ë„ˆêµ¬ë¦¬ì˜ ê¼¬ë¦¬ ì…ˆ</h2>
                <div class="story-text">
                    "ë§ˆì§€ë§‰ ë¬¸ì œì•¼. ë‚œ ê¼¬ë¦¬ì— ì¤„ë¬´ëŠ¬ê°€ ì—†ì–´."<br>
                    (ë°œê°€ë½ 4ê°œ) Ã— (ê¼¬ë¦¬ ì¤„ë¬´ëŠ¬ ?) + (ë‹¤ë¦¬ 4ê°œ) = <strong>?</strong>
                </div>
                <input type="number" id="ep2-input-math" placeholder="ìˆ«ì ì…ë ¥">
                <p id="ep2-hint-math" style="display:none; color:#ff6b6b; text-align:center; margin-bottom:10px;">
                    íŒíŠ¸: ê¼¬ë¦¬ ì¤„ë¬´ëŠ¬ëŠ” 0ê°œì•¼!<br>(4 Ã— 0) + 4 ë¥¼ ê³„ì‚°í•´ë´.
                </p>
                <button class="btn" onclick="Ep2Game.checkMath()">ì •ë‹µ í™•ì¸</button>
            </div>

            <div class="scene" id="ep2-7">
                <h2 style="color:var(--accent-ep2)">ğŸ‰ ì—í”¼ì†Œë“œ 2 í´ë¦¬ì–´!</h2>
                <div class="img-box">
                    <img src="img/3.ë„ˆêµ¬ë¦¬ 3ë²ˆ.jpg" alt="ë‚˜ë­‡ì">
                </div>
                <div class="story-text">
                    "ìš°ë¦¬ëŠ” ì„œë¡œ ë‹¿ì§€ ì•Šì•„ë„ ë§ˆìŒìœ¼ë¡œ ì•„ê»´ì£¼ëŠ” ì¹œêµ¬ì•¼."<br>
                    ë„ˆêµ¬ë¦¬ëŠ” ìˆ²ìœ¼ë¡œ ì‚¬ë¼ì§€ë©° ì´ˆë¡ìƒ‰ <strong>[ë§ˆë²• ë‚˜ë­‡ì]</strong>ì„ ë‚¨ê²¼ë‹¤.
                </div>
                <button class="btn" onclick="GameSystem.clearEpisode(2)">ë³¸ë¶€ë¡œ ë³µê·€</button>
            </div>
        </div>

        <!-- #################### EP3 ë”±ë”°êµ¬ë¦¬ #################### -->
        <div id="section-ep3" class="game-section">
            <div class="scene active" id="ep3-1">
                <h2 style="color:var(--accent-ep3)">EP3. ìœ„ê¸°ì˜ ê±´ì¶•ê°€</h2>
                <div class="img-box">
                    <img src="img/4.ì˜¤ìƒ‰ë”±ë”°êµ¬ë¦¬ 1ë²ˆ.jpg" alt="ë”±ë”°êµ¬ë¦¬">
                </div>
                <div class="story-text">
                    ìˆ²ì†ì—ì„œ ë™ë™ ì•“ëŠ” ì†Œë¦¬ê°€ ë“¤ë ¤ì™”ì–´.<br>
                    "ì•„ì´ê³ , ë¨¸ë¦¬ì•¼..."<br>
                    ìˆ²ì˜ ë“œëŸ¬ë¨¸ <strong>ì˜¤ìƒ‰ë”±ë”°êµ¬ë¦¬</strong>ê°€ ê´´ë¡œì›Œí•˜ê³  ìˆì–´.
                </div>
                <button class="btn" onclick="SceneManager.next('ep3', 1)">ë”±ë”°êµ¬ë¦¬ ë§Œë‚˜ëŸ¬ ê°€ê¸°</button>
            </div>

            <div class="scene" id="ep3-2">
                <h2 style="color:var(--accent-ep3)">M1. ì§„ì§œ ë‚˜ë¥¼ ì°¾ì•„ì¤˜</h2>
                <div class="story-text">
                    "ì–´ì§€ëŸ¬ì›Œì„œ ê±°ìš¸ì´ ì•ˆ ë³´ì—¬...<br>
                    ë‚´ ë°°ëŠ” <strong>ë¹¨ê°„ìƒ‰</strong>ì´ê³  ë“±ì—ëŠ” <strong>í° ì </strong>ì´ ìˆì–´."
                </div>
                <button class="choice-btn" onclick="GameUI.modal('ë‚˜ëŠ” ë¨¸ë¦¬ ì „ì²´ê°€ ë¹¨ê°„ í¬ë‚™ìƒˆì•¼. (ì§€ê¸ˆì€ ë©¸ì¢…ë˜ì—ˆì–´)')">A. ë¨¸ë¦¬ ì „ì²´ê°€ ë¹¨ê°„ ìƒˆ</button>
                <button class="choice-btn" onclick="GameUI.modal('ë”©ë™ëŒ•! ë‚˜ëŠ” ì˜¤ìƒ‰ë”±ë”°êµ¬ë¦¬ì•¼.'); SceneManager.next('ep3', 2);">B. ê²€ì€ ë“±, í° ì , ë¹¨ê°„ ë°°</button>
                <button class="choice-btn" onclick="GameUI.modal('ë‚˜ëŠ” ì˜¨ëª¸ì´ íšŒìƒ‰ì¸ ì²­ë”±ë”°êµ¬ë¦¬ì•¼.')">C. ëª¸ ì „ì²´ê°€ íšŒìƒ‰ì¸ ìƒˆ</button>
            </div>

            <!-- M2: ë¦¬ë“¬ ê²Œì„ (5ê°œ, ì²œì²œíˆ) -->
            <div class="scene" id="ep3-3">
                <h2 style="color:var(--accent-ep3)">M2. ìˆ²ì†ì˜ ë¦¬ë“¬ ê²Œì„</h2>
                <div class="story-text">
                    "ë²Œë ˆë¥¼ ì¡ì•„ í˜ì„ ë‚´ì•¼ í•´. ë‚´ê°€ ë‚˜ë¬´ ìª¼ëŠ” ìˆœì„œë¥¼ ê¸°ì–µí•´ì„œ ë”°ë¼ í•´ì¤˜!"
                </div>
                <div id="rhythm-status" style="text-align:center; color:#ffd700; margin-bottom:10px;">[ì‹œì‘] ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”</div>
                <div class="memory-grid">
                    <script>for(let i=1; i<=16; i++) document.write(`<div class="memory-hole" id="hole-${i}" onclick="Ep3Game.userClick(${i})">${i}</div>`);</script>
                </div>
                <button class="btn" id="rhythm-start-btn" onclick="Ep3Game.startGame()">ì‹œì‘! (ìˆœì„œ ê¸°ì–µí•˜ê¸°)</button>
            </div>

            <!-- M3: 1-20 ì•”í˜¸í‘œ (800x800, ì´ë¯¸ì§€ ë°•ìŠ¤ ì œê±°) -->
            <div class="scene" id="ep3-4">
                <h2 style="color:var(--accent-ep3)">M3. ë‚˜ë¬´ì˜ ë¹„ë°€ ë©”ì‹œì§€</h2>
                <div class="story-text">
                    "ë‹¨ë‹¨í•œ ë‚˜ë¬´ë¥¼ ìª¼ì•˜ë”ë‹ˆ ë¨¸ë¦¬ê°€ ë„ˆë¬´ ì•„íŒŒ.<br>
                    <strong>ë‚´ê²Œ í•„ìš”í•œ ê±´ ì–´ë–¤ ë‚˜ë¬´ì¼ê¹Œ?</strong><br>
                    ë‚˜ë¬´ ê»ì§ˆì— ë‚¨ê¸´ ë©”ì‹œì§€ë¥¼ í’€ì–´ì¤˜!"
                </div>
                <div class="code-table">
                    <!-- 1~20 ëœë¤ ë°°ì¹˜ (6=ê³ , 2=ì‚¬, 5=ëª© ê³ ì •, ë‚˜ë¨¸ì§€ ëœë¤) -->
                    <div class="code-item">1.í•´</div><div class="code-item">2.ì‚¬</div><div class="code-item">3.ëŒ</div><div class="code-item">4.ë°”</div><div class="code-item">5.ëª©</div>
                    <div class="code-item">6.ê³ </div><div class="code-item">7.ë¬¼</div><div class="code-item">8.í™</div><div class="code-item">9.ê½ƒ</div><div class="code-item">10.í’€</div>
                    <div class="code-item">11.ì§‘</div><div class="code-item">12.ìƒ</div><div class="code-item">13.ë‹¬</div><div class="code-item">14.ë³„</div><div class="code-item">15.ìˆ²</div>
                    <div class="code-item">16.êµ¬</div><div class="code-item">17.ë¦„</div><div class="code-item">18.ë¹„</div><div class="code-item">19.ëˆˆ</div><div class="code-item">20.ì‚°</div>
                </div>
                <div style="text-align:center; font-size:1.5rem; color:#ff6b6b; margin-bottom:10px;">Q. ì•”í˜¸: 625</div>
                <input type="text" id="ep3-input-code" placeholder="ì •ë‹µ ë‹¨ì–´ ì…ë ¥">
                <button class="btn" onclick="Ep3Game.checkCode()">í•´ë…í•˜ê¸°</button>
            </div>

            <!-- M4: í•˜ëŠ˜ë‹¤ëŒì¥ íŠ¹ì§• í€´ì¦ˆ (5ê°€ì§€ íŠ¹ì§•) -->
            <div class="scene" id="ep3-5">
                <h2 style="color:var(--accent-ep3)">M4. ë¹ˆì§‘ì˜ ì£¼ì¸ì€?</h2>
                <div class="story-text">
                    "ë‚´ê°€ ì´ì‚¬ë¥¼ ê°€ë©´ ì´ ì¹œêµ¬ê°€ ë¹ˆ ë‘¥ì§€ë¥¼ ì¨.<br>
                    <strong>íŠ¹ì§• 5ê°€ì§€ë¥¼ ë³´ê³  ëˆ„êµ°ì§€ ë§ì¶°ë´!</strong>"
                </div>
                <div style="background:#333; padding:15px; border-radius:10px; margin-bottom:15px; text-align:left; font-size:0.9rem;">
                    1. ì•ë‹¤ë¦¬ì™€ ë’·ë‹¤ë¦¬ ì‚¬ì´ì— <strong>ë‚ ê°œë§‰(ë¹„ë§‰)</strong>ì´ ìˆì–´ì„œ ìŠ~ ë‚  ìˆ˜ ìˆì–´ìš”.<br>
                    2. ë°¤í•˜ëŠ˜ì„ ë‚ ì•„ë‹¤ë‹Œë‹¤.<br>
                    3. ëˆˆì´ ì•„ì£¼ í¬ë‹¤.<br>
                    4. ì²œì—°ê¸°ë…ë¬¼ì´ë‹¤.<br>
                    5. ê·€ì—¬ìš´ ì™¸ëª¨ë¥¼ ê°€ì¡Œë‹¤.
                </div>
                <input type="text" id="ep3-input-friend" placeholder="ë‹¤ì„¯ ê¸€ì ì…ë ¥">
                <p id="ep3-hint-friend" style="display:none; color:#ff6b6b; text-align:center;">íŒíŠ¸: ã…ã„´ã„·ã„¹ã…ˆ</p>
                <button class="btn" onclick="Ep3Game.checkFriend()">ì •ë‹µ í™•ì¸</button>
            </div>

            <div class="scene" id="ep3-6">
                <h2 style="color:var(--accent-ep3)">Final. ìˆ²ì˜ ì•„ì¹˜ëŒ</h2>
                <div class="story-text">
                    "ë§ˆì§€ë§‰ ë¬¸ì œì•¼. ë‚˜ì²˜ëŸ¼ ìƒíƒœê³„ ì „ì²´ë¥¼ ì§€íƒ±í•˜ëŠ” ì¤‘ìš”í•œ ìƒë¬¼ì„ ë¬´ì—‡ì´ë¼ê³  í• ê¹Œ?"<br>
                    (íŒíŠ¸: ã… ã…… ã…ˆ)
                </div>
                <input type="text" id="ep3-input-key" placeholder="ì„¸ ê¸€ì ì…ë ¥">
                <button class="btn" onclick="Ep3Game.checkKey()">ì •ë‹µ í™•ì¸</button>
            </div>

            <div class="scene" id="ep3-7">
                <h2 style="color:var(--accent-ep3)">ğŸ‰ ì—í”¼ì†Œë“œ 3 í´ë¦¬ì–´!</h2>
                <div class="img-box">
                    <img src="img/4.ì˜¤ìƒ‰ë”±ë”°êµ¬ë¦¬ 2ë²ˆ.jpg" alt="ë§ˆìŠ¤í„°í‚¤">
                </div>
                <div class="story-text">
                    "ì´ê±´ [ìˆ²ì†ì˜ ë§ˆìŠ¤í„°í‚¤]ì•¼.<br>
                    ë§‰íŒ ê³³ì„ ëš«ì–´ ìˆ²ì— ìˆ¨í†µì„ íŠ¸ì´ê²Œ í•˜ëŠ” ë‚˜ì²˜ëŸ¼,<br>
                    ë„ˆë„ ë‹µë‹µí•œ ë¬¸ì œë¥¼ ì‹œì›í•˜ê²Œ í•´ê²°í•˜ëŠ” ì‚¬ëŒì´ ë˜ê¸¸ ë°”ë„ê²Œ."
                </div>
                <button class="btn" onclick="GameSystem.clearEpisode(3)">ë³¸ë¶€ë¡œ ë³µê·€</button>
            </div>
        </div>

        <!-- #################### EP4 ì‚µ #################### -->
        <div id="section-ep4" class="game-section">
            <div class="scene active" id="ep4-1">
                <h2 style="color:var(--accent-ep4)">EP4. ê³ ë…í•œ ì‚¬ëƒ¥ê¾¼</h2>
                <div class="img-box">
                    <img src="img/5.ì‚µ 1ë²ˆ.jpg" alt="ì‚µ">
                </div>
                <div class="story-text">
                    ë¶í•œì‚° ìë½ì˜ ìŠµì§€. ê°ˆëŒ€ ìˆ² ì‚¬ì´ë¡œ ë‚ ì¹´ë¡œìš´ ëˆˆë¹›ì´ ë²ˆì©ì˜€ì–´.<br>
                    "ë‚˜ëŠ” ì´ê³³ì— ìˆ¨ì£½ì—¬ ì‚´ê³  ìˆì–´... ì¹œêµ¬ë“¤ì´ ë³´ê³  ì‹¶ì–´."
                </div>
                <button class="btn" onclick="SceneManager.next('ep4', 1)">ì‚µ ë§Œë‚˜ëŸ¬ ê°€ê¸°</button>
            </div>

            <div class="scene" id="ep4-2">
                <h2 style="color:var(--accent-ep4)">M1. ë‚˜ëŠ” ê³ ì–‘ì´ê°€ ì•„ë‹ˆì•¼!</h2>
                <div class="story-text">
                    "ì‚¬ëŒë“¤ì€ ë‚˜ë¥¼ ê¸¸ê³ ì–‘ì´ë¡œ ì°©ê°í•´. ë‚˜ì˜ íŠ¹ì§• 2ê°€ì§€ë¥¼ ê³¨ë¼ì¤˜."
                </div>
                <div style="text-align:left; padding:15px; background:#333; border-radius:10px; margin-bottom:20px; width:100%;">
                    <label style="display:block; padding:10px;"><input type="checkbox" name="salk" value="x"> 1. ê¼¬ë¦¬ê°€ ê°€ëŠ˜ê³  ê¸¸ë‹¤</label>
                    <label style="display:block; padding:10px;"><input type="checkbox" name="salk" value="o"> 2. ê·€ ë’¤ì— í° ë°˜ì ì´ ìˆë‹¤</label>
                    <label style="display:block; padding:10px;"><input type="checkbox" name="salk" value="o"> 3. ê¼¬ë¦¬ê°€ ë‘ê»ê³  ë­‰íˆ­í•˜ë‹¤</label>
                    <label style="display:block; padding:10px;"><input type="checkbox" name="salk" value="x"> 4. ì‚¬ëŒì„ ì˜ ë”°ë¥¸ë‹¤</label>
                </div>
                <button class="btn" onclick="Ep4Game.checkFeatures()">í™•ì¸</button>
            </div>

            <!-- M2: ë°œìêµ­ -->
            <div class="scene" id="ep4-3">
                <h2 style="color:var(--accent-ep4)">M2. ë°œìêµ­ì„ ì¶”ì í•˜ë¼</h2>
                <!-- 980x980 ì ìš© -->
                <div style="width:100%; max-width:400px; aspect-ratio:980/980; margin:0 auto 20px;">
                    <img src="img/5.ì‚µ 2ë²ˆ.jpg" style="width:100%; height:100%; object-fit:contain; border-radius:10px;">
                </div>
                <div class="story-text">
                    "ì—¬ëŸ¬ ë™ë¬¼ë“¤ì´ ìˆ²ì„ ì§€ë‚˜ê°”ì–´.<br>
                    ë‚´ ë°œìêµ­ì€ ê¹Šì€ ìˆ²ì† <strong>ì´ê³³</strong>ìœ¼ë¡œ ì´ì–´ì ¸ ìˆì–´."
                </div>
                <button class="choice-btn" onclick="GameUI.modal('ì •ë‹µ! ë‚´ ë°œìêµ­ì€ ìš°ì´ë ¹ê¸¸ë¡œ ì´ì–´ì ¸ ìˆì–´.'); SceneManager.next('ep4', 3);">A. ìš°ì´ë ¹ê¸¸</button>
                <button class="choice-btn" onclick="GameUI.modal('ì—¬ê¸°ëŠ” ì‚¬ëŒì´ ë„ˆë¬´ ë§ì•„.')">B. ë¶ì„œìš¸ê¿ˆì˜ìˆ²</button>
                <button class="choice-btn" onclick="GameUI.modal('ì—¬ê¸´ ë°”ìœ„ê°€ ë„ˆë¬´ ë§ì•„.')">C. ë¶í•œì‚°</button>
                <button class="choice-btn" onclick="GameUI.modal('ì—¬ê¸´ ë¬¼ì´ íë¥´ëŠ” ê³³ì´ì•¼.')">D. ìš°ì´ì²œ</button>
            </div>

            <!-- M3: ë¡œë“œí‚¬ (ê²Œì„ ë¡œì§ ìˆ˜ì •: í´ë¦­ ì´ë™, TXT íŒŒì¼ ì°¸ì¡°) -->
            <div class="scene" id="ep4-4">
                <h2 style="color:var(--accent-ep4)">Mission 3. ì£½ìŒì˜ ë„ë¡œ ê±´ë„ˆê¸°</h2>
                <div class="story-text">
                    "ë¨¹ì´ë¥¼ ì°¾ìœ¼ë ¤ë©´ ë„ë¡œë¥¼ ê±´ë„ˆì•¼ í•´.<br>
                    ì°¨ê°€ ì˜¤ì§€ ì•ŠëŠ” í‹ˆì„ íƒ€ì„œ <strong>[ì´ë™]</strong> ë²„íŠ¼ì„ <strong>ì¡°ê¸ˆì”© í´ë¦­</strong>í•´ì„œ ì•„ë˜ìª½ ì•ˆì „êµ¬ì—­ê¹Œì§€ ê±´ë„ˆê°€ê²Œ í•´ì¤˜!"
                </div>
                
                <div class="road-scene">
                    <div class="player-salk" id="player-salk">ğŸ˜¿</div> <!-- ê¸°ë³¸ ìºë¦­í„°: ìš¸ê³ ìˆëŠ” ê³ ì–‘ì´ -->
                    <div class="center-line"></div>
                    <div class="safe-zone-end">ì•ˆì „ êµ¬ì—­ (ë„ì°©)</div>
                    
                    <!-- ì¥ì• ë¬¼ ì°¨ëŸ‰ (ë°˜ì „ ì ìš©) -->
                    <div class="enemy-car car-top" id="car1" style="left: 100px;">ğŸš—</div>
                    <div class="enemy-car car-bottom" id="car2" style="left: 200px;">ğŸš™</div>
                </div>
                
                <div id="road-msg" style="height:30px; font-weight:bold; color:#f4a261;">ì¤€ë¹„...</div>

                <button class="btn" id="move-btn" onclick="Ep4Game.moveSalkClick()">ì´ë™ (ì•ˆì „í•  ë•Œ ì¡°ê¸ˆì”© í´ë¦­)</button>
            </div>

            <!-- M4: ë¨¹ì´ì‚¬ìŠ¬ -->
            <div class="scene" id="ep4-5">
                <h2 style="color:var(--accent-ep4)">M4. ë¬´ë„ˆì§„ ë¨¹ì´ì‚¬ìŠ¬</h2>
                <div class="story-text">
                    "ë¨¹ì´ì‚¬ìŠ¬ ì¡°ê°ì„ ì•Œë§ì€ ì¹¸ì— ëˆŒëŸ¬ <strong>ì•„ë˜ì—ì„œ ìœ„ë¡œ</strong> íƒ‘ì„ ìŒ“ì•„ì¤˜!"
                </div>
                <div class="piece-container">
                    <div class="puzzle-piece" id="p-salk" onclick="Ep4Game.selectPiece('salk')">ğŸ†<br>ì‚µ</div>
                    <div class="puzzle-piece" id="p-bug" onclick="Ep4Game.selectPiece('bug')">ğŸ¦—<br>ê³¤ì¶©</div>
                    <div class="puzzle-piece" id="p-bird" onclick="Ep4Game.selectPiece('bird')">ğŸ¦<br>ìƒˆ</div>
                    <div class="puzzle-piece" id="p-grass" onclick="Ep4Game.selectPiece('grass')">ğŸŒ¿<br>í’€</div>
                    <div class="puzzle-piece" id="p-mouse" onclick="Ep4Game.selectPiece('mouse')">ğŸ­<br>ì¥</div>
                </div>
                <div class="pyramid-container">
                    <div class="puzzle-slot" id="slot-5" onclick="Ep4Game.placePiece(5)">5. ìµœìƒìœ„ í¬ì‹ì</div>
                    <div class="puzzle-slot" id="slot-4" onclick="Ep4Game.placePiece(4)">4. 3ì°¨ ì†Œë¹„ì</div>
                    <div class="puzzle-slot" id="slot-3" onclick="Ep4Game.placePiece(3)">3. 2ì°¨ ì†Œë¹„ì</div>
                    <div class="puzzle-slot" id="slot-2" onclick="Ep4Game.placePiece(2)">2. 1ì°¨ ì†Œë¹„ì</div>
                    <div class="puzzle-slot" id="slot-1" onclick="Ep4Game.placePiece(1)">1. ìƒì‚°ì (ë§¨ ì•„ë˜)</div>
                </div>
                <button class="btn" onclick="Ep4Game.checkPuzzle()">ì™„ì„± í™•ì¸</button>
            </div>

            <div class="scene" id="ep4-6">
                <h2 style="color:var(--accent-ep4)">Final. ìˆ²ì˜ ë©”ì‹œì§€</h2>
                <div class="story-text">
                    "ë„¤ ë•ë¶„ì— ë‚´ê°€ ë‹¤ì‹œ ë¶í•œì‚°ìœ¼ë¡œ ëŒì•„ì˜¬ ìˆ˜ ìˆì—ˆì–´.<br>
                    ë‚˜ì˜ ì—­í• ì€ ìˆ²ì˜ OOOOOì„ ì§€í‚¤ëŠ” ê±°ì•¼."<br>
                    (íŒíŠ¸: ã……ã…ã„·ã…‡ã……)
                </div>
                <input type="text" id="ep4-input-final" placeholder="ë‹¤ì„¯ ê¸€ì ì…ë ¥">
                <button class="btn" onclick="Ep4Game.checkFinal()">ì •ë‹µ í™•ì¸</button>
            </div>

            <div class="scene" id="ep4-7">
                <h2 style="color:var(--accent-ep4)">ğŸ‰ ì—í”¼ì†Œë“œ 4 í´ë¦¬ì–´!</h2>
                <div class="img-box">
                    <img src="img/5.ì‚µ 3ë²ˆ.jpg" alt="í˜¸ë°•ì„">
                </div>
                <div class="story-text">
                    "ì •ë‹µì€ ìƒë¬¼ë‹¤ì–‘ì„±ì´ì•¼!<br>
                    ì´ê±´ [ìš©ë§¹ì˜ í˜¸ë°•ì„]ì´ì•¼. ë„ˆì˜ ìš©ê¸°ë¥¼ ì˜ì›íˆ ê¸°ì–µí• ê²Œ."
                </div>
                <button class="btn" onclick="GameSystem.clearEpisode(4)">ë³¸ë¶€ë¡œ ë³µê·€</button>
            </div>
        </div>

        <!-- #################### ì—”ë”© #################### -->
        <div id="section-ending" class="game-section">
            <div class="scene active" id="ending-1">
                <h2>#1. ê¿ˆì—ì„œ ê¹¨ì–´ë‚˜ë‹¤</h2>
                <div class="img-box" style="aspect-ratio: 980/715;">
                    <img src="img/6.ì—”ë”© 1ë²ˆ.jpg" alt="ì°½ë°–">
                </div>
                <div class="story-text">
                    ëˆˆì„ ëœ¨ì ìµìˆ™í•œ ë‚´ ë°© ì²œì¥ì´ ë³´ì˜€ë‹¤.<br>
                    ë‚´ ì†ì—ëŠ” ìˆ²ì† ì¹œêµ¬ë“¤ì´ ë‚¨ê¸´ ì¦í‘œë“¤ì´ ë¬µì§í•˜ê²Œ ë‚¨ì•„ìˆì—ˆë‹¤.
                </div>
                <button class="btn" onclick="SceneManager.next('ending', 1)">ê¹Šì€ ìƒê°ì— ì ê¸´ë‹¤</button>
            </div>

            <div class="scene" id="ending-2">
                <h2>#2. ë³´ì´ì§€ ì•ŠëŠ” ì´ì›ƒë“¤</h2>
                <!-- 1080x662 ë¹„ìœ¨ ì ìš© -->
                <div class="img-box" style="width:100%; aspect-ratio:1080/662;">
                    <img src="img/6.ì—”ë”© 2ë²ˆ.jpg" alt="ë™ë¬¼ë“¤">
                </div>
                <div class="story-text">
                    ë°”ìœ„ í‹ˆ ì‚°ê°œë‚˜ë¦¬, ë‘í†µì„ ì•“ëŠ” ë”±ë”°êµ¬ë¦¬, ë¡œë“œí‚¬ ë‹¹í•˜ëŠ” ë„ˆêµ¬ë¦¬, ê°ˆëŒ€ ìˆ²ì˜ ì‚µ...<br>
                    ì´ë“¤ì€ ìš°ë¦¬ì™€ í•¨ê»˜ ì‚´ì•„ê°€ëŠ” <strong>ë³´ì´ì§€ ì•ŠëŠ” ì´ì›ƒ</strong>ë“¤ì´ì—ˆë‹¤.
                </div>
                <button class="btn" onclick="SceneManager.next('ending', 2)">ìˆ˜ì²©ì„ êº¼ë‚¸ë‹¤</button>
            </div>

            <!-- Scene 3: ì „í™˜ (íƒì • -> ì§€í‚´ì´) -->
            <div id="ending-3" class="scene">
                <h2>#3. íƒì •ì„ ë„˜ì–´ ì§€í‚´ì´ë¡œ</h2>
                <div class="story-text">
                    ë‚˜ëŠ” ì„œë ì†ì— ìˆë˜ 'íƒì • ìˆ˜ì²©'ì„ êº¼ëƒˆë‹¤.<br>
                    ì§€ê¸ˆê¹Œì§€ ìš°ë¦¬ëŠ” ê·¸ë“¤ì´ 'ëˆ„êµ¬'ì´ê³  'ì™œ' ì•„í”ˆì§€ ë°í˜€ë‚´ëŠ” ê´€ì°°ì(íƒì •)ì˜€ë‹¤.<br><br>
                    í•˜ì§€ë§Œ ë¬¸ì œë¥¼ ì•„ëŠ” ê²ƒë§Œìœ¼ë¡œëŠ” ì•„ë¬´ê²ƒë„ ë°”ë€Œì§€ ì•ŠëŠ”ë‹¤.<br>
                    ì§„ì •í•œ í•´ê²°ì€ í–‰ë™ì—ì„œ ì‹œì‘ëœë‹¤.<br><br>
                    
                    ë‚˜ëŠ” ìˆ˜ì²© í‘œì§€ì˜ 'íƒì •ë‹¨'ì´ë¼ëŠ” ê¸€ì ìœ„ì— ë‘ ì¤„ì„ ê¸‹ê³ , ìƒˆë¡œìš´ ì´ë¦„ì„ ê¾¹ê¾¹ ëˆŒëŸ¬ì¼ë‹¤.
                </div>
                <div class="img-box" style="height:120px; background:none; border:none;">
                    <div style="font-size:2rem; color:#888; text-decoration: line-through;">ìƒíƒœíƒì •ë‹¨</div>
                    <div style="font-size:2.5rem; color:#00ff9d; font-weight:bold; margin-top:10px;">ìƒíƒœì§€í‚´ì´</div>
                </div>
                <button class="btn" onclick="SceneManager.next('ending', 3)">ë‹¤ì§ì„ ê¸°ë¡í•œë‹¤</button>
            </div>

            <div class="scene" id="ending-4">
                <h2>#4. ìš°ë¦¬ì˜ ì•½ì†</h2>
                <div class="story-text" style="background:#fff; color:#000;">
                    <div style="text-align:center; border-bottom:2px solid #000; padding-bottom:10px; margin-bottom:10px; font-weight:bold;">ğŸŒ¿ ê°•ë¶ ìƒíƒœì§€í‚´ì´ì˜ ì•½ì† ğŸŒ¿</div>
                    1. ë‚˜ëŠ” ì§€êµ¬ì˜ ëª¨ë“  ìƒëª…ì„ ì¡´ì¤‘í•˜ê² ìŠµë‹ˆë‹¤.<br>
                    2. ë‚˜ëŠ” ì¼íšŒìš©í’ˆ ì‚¬ìš©ì„ ì¤„ì—¬ ê¸°í›„ ìœ„ê¸°ë¡œë¶€í„° ìˆ²ì„ ì§€í‚¤ê² ìŠµë‹ˆë‹¤.<br>
                    3. ë‚˜ëŠ” ìˆ²ì— ì“°ë ˆê¸°ë¥¼ ë²„ë¦¬ì§€ ì•Šê³ , ê¹¨ë—í•˜ê²Œ ì§€í‚¤ê² ìŠµë‹ˆë‹¤.<br>
                    4. ë‚˜ëŠ” ê¸¸ì—ì„œ ì•¼ìƒë™ë¬¼ì„ ë§Œë‚˜ë©´ ì¡°ìš©íˆ ê±°ë¦¬ë¥¼ ë‘ê² ìŠµë‹ˆë‹¤.<br>
                    5. ë‚˜ëŠ” ìš°ë¦¬ ë§ˆì„ì˜ ë‹¤ì–‘í•œ ìƒë¬¼ë“¤ì— ëŒ€í•´ ì¹œêµ¬ë“¤ì—ê²Œ ì•Œë ¤ì£¼ê² ìŠµë‹ˆë‹¤.
                </div>
                <div class="img-box">
                    <img src="img/6.ì—”ë”© 3ë²ˆ.jpg" alt="ê³µì¡´">
                </div>
                <div class="story-text">
                    ì°½ë¬¸ì„ ì—´ì ì‹œì›í•œ ë°”ëŒì´ ë¶ˆì–´ì˜¨ë‹¤.<br>
                    ì•„ìŠ¤íŒ”íŠ¸ í‹ˆì˜ ì‘ì€ í’€ê½ƒë„, í•˜ëŠ˜ì„ ë‚˜ëŠ” ìƒˆë„<br>
                    ëª¨ë‘ ë‚˜ì™€ í•¨ê»˜ ì‚´ì•„ê°€ëŠ” ìƒëª…ì´ë¼ëŠ” ê±¸ ì•Œì•˜ìœ¼ë‹ˆê¹Œ.<br><br>
                    <strong>"ì´ì œ ì‹œì‘ì´ì•¼. ìš°ë¦¬ê°€ í•¨ê»˜ ì‚´ì•„ê°ˆ ë‚´ì¼ì€."</strong>
                </div>
                <button class="btn" onclick="EndGame.celebrate()">ìƒˆë¡œìš´ ì‹œì‘</button>
            </div>
        </div>

    </div>

    <script>
        /* === UI ê´€ë¦¬ì === */
        const GameUI = {
            modal: function(msg) {
                document.getElementById('modal-text').innerText = msg;
                document.getElementById('custom-modal').style.display = 'flex';
            },
            closeModal: function() {
                document.getElementById('custom-modal').style.display = 'none';
            }
        };

        /* === 1. ì‹œìŠ¤í…œ ê´€ë¦¬ì === */
        const GameSystem = {
            clearedEpisodes: [], 
            startEpisode: function(epNum) {
                if(this.clearedEpisodes.includes(epNum)) return GameUI.modal("ì´ë¯¸ í•´ê²°í•œ ì‚¬ê±´ì…ë‹ˆë‹¤! (ë„ì¥ì´ ì°í˜€ìˆì–´ìš”)");
                document.querySelectorAll('.game-section').forEach(el => el.classList.remove('active'));
                document.getElementById(`section-ep${epNum}`).classList.add('active');
                SceneManager.reset(`ep${epNum}`);
                if(epNum === 3) Ep3Game.resetGame();
                if(epNum === 4) Ep4Game.initRoadGame();
            },
            clearEpisode: function(epNum) {
                if(!this.clearedEpisodes.includes(epNum)) {
                    this.clearedEpisodes.push(epNum);
                    document.getElementById(`door-${epNum}`).classList.add('cleared');
                }
                this.goToLobby();
            },
            goToLobby: function() {
                document.querySelectorAll('.game-section').forEach(el => el.classList.remove('active'));
                document.getElementById('section-lobby').classList.add('active');
                if(this.clearedEpisodes.length === 4) document.getElementById('final-btn').style.display = 'block';
            },
            goToEnding: function() {
                document.querySelectorAll('.game-section').forEach(el => el.classList.remove('active'));
                document.getElementById('section-ending').classList.add('active');
            }
        };

        /* === 2. ì¥ë©´ ê´€ë¦¬ì (ëˆ„ì í˜• ìŠ¤í¬ë¡¤) === */
        const SceneManager = {
            next: function(sectionId, currentIdx) {
                const currentScene = document.getElementById(`${sectionId}-${currentIdx}`);
                const nextScene = document.getElementById(`${sectionId}-${currentIdx + 1}`);
                if(currentScene) {
                    currentScene.classList.add('finished');
                    const btns = currentScene.querySelectorAll('button');
                    btns.forEach(btn => {
                        btn.disabled = true; btn.classList.add('disabled');
                        if(['ì •ë‹µ í™•ì¸','í™•ì¸'].includes(btn.innerText)) btn.innerText = "ì™„ë£Œ";
                    });
                }
                if(nextScene) {
                    nextScene.classList.add('active');
                    setTimeout(() => nextScene.scrollIntoView({ behavior: 'smooth', block: 'start' }), 100);
                }
            },
            reset: function(sectionId) {
                const container = document.getElementById(`section-${sectionId}`);
                container.querySelectorAll('.scene').forEach(s => {
                    s.classList.remove('active', 'finished');
                    s.querySelectorAll('button').forEach(btn => { btn.disabled = false; btn.classList.remove('disabled'); });
                });
                container.querySelector('.scene').classList.add('active');
                document.getElementById('game-wrapper').scrollTop = 0;
            }
        };

        /* === 3. ì—í”¼ì†Œë“œë³„ ë¡œì§ === */
        // EP1 ì‚°ê°œë‚˜ë¦¬
        const Ep1Game = {
            foundCount: 0,
            catchItem: function(el) {
                const marker = el.nextElementSibling;
                if(marker.style.display === 'block') return; 
                el.style.display = 'none'; marker.style.display = 'block';
                this.foundCount++;
                document.getElementById('ep1-cnt').innerText = `ì°¾ì€ íŠ¹ì§•: ${this.foundCount} / 3`;
                if(this.foundCount === 3) {
                    GameUI.modal('ë ë§~! ëŒ€ë‹¨í•´! íŠ¹ì§•ì„ ëª¨ë‘ ì°¾ì•˜ì–´!');
                    document.getElementById('ep1-btn-2').style.display = 'block';
                }
            },
            checkAnswer1: function() {
                const val = document.getElementById('ep1-input-1').value;
                if(val.includes('ë¦¬ê¸°ë‹¤')) { GameUI.modal('ë ë§~! ì •ë‹µ! ë¦¬ê¸°ë‹¤ì†Œë‚˜ë¬´ì•¼.'); SceneManager.next('ep1', 3); }
                else this.wrongAnswer('íŒíŠ¸: ã„¹ã„±ã„· ì†Œë‚˜ë¬´');
            },
            checkAnswer2: function() {
                if(document.getElementById('ep1-input-2').value.replace(/\s/g,'') === 'ìƒë¬¼ë‹¤ì–‘ì„±') {
                    GameUI.modal('ë ë§~! ì •ë‹µ! ë‹¤ì–‘í•´ì•¼ ê±´ê°•í•´ì ¸.'); SceneManager.next('ep1', 5);
                } else this.wrongAnswer('íŒíŠ¸: ã……ã…ã„·ã…‡ã……');
            },
            checkAnswer3: function() {
                if(document.getElementById('ep1-input-3').value.replace(/\s/g,'') === 'ë‹¤ì–‘í•´ì•¼ê°•í•˜ë‹¤') {
                    GameUI.modal('ë ë§~! ì£¼ë¬¸ ì„±ê³µ!'); SceneManager.next('ep1', 6);
                } else this.wrongAnswer('ì•”í˜¸í‘œë¥¼ ë³´ê³  ê¸€ìë¥¼ ì¡°í•©í•´ë´.');
            },
            wrongAnswer: function(msg) {
                GameUI.modal(msg); document.getElementById('section-ep1').classList.add('shake');
                setTimeout(()=>document.getElementById('section-ep1').classList.remove('shake'), 400);
            }
        };

        // EP2 ë„ˆêµ¬ë¦¬
        const Ep2Game = {
            toggleTrash: function(el) { el.classList.toggle('selected'); },
            submitTrash: function() {
                const selected = document.querySelectorAll('.trash-item.selected');
                if(selected.length !== 4) return GameUI.modal('4ê°œë¥¼ ì„ íƒí•´ì•¼ í•´!');
                let correct = true;
                selected.forEach(el => { if(el.dataset.v === 'x') correct = false; });
                if(correct) { GameUI.modal('ë ë§~! ì™„ë²½í•´!'); SceneManager.next('ep2', 2); }
                else { GameUI.modal('ì¬í™œìš© ì•ˆ ë˜ëŠ” ê²Œ ì„ì—¬ìˆì–´.'); document.getElementById('section-ep2').classList.add('shake'); setTimeout(()=>document.getElementById('section-ep2').classList.remove('shake'),400); }
            },
            bridgeWord: "",
            addBridge: function(char) {
                if(this.bridgeWord.length < 4) { this.bridgeWord += char; document.getElementById('bridge-display').innerText = this.bridgeWord; }
            },
            resetBridge: function() { this.bridgeWord = ""; document.getElementById('bridge-display').innerText = "____"; },
            checkBridge: function() {
                if(this.bridgeWord === "ìƒíƒœí†µë¡œ") { GameUI.modal("ë ë§~! ë‹¤ë¦¬ ì™„ì„±!"); SceneManager.next('ep2', 4); }
                else { GameUI.modal("ë‹¤ì‹œ ìƒê°í•´ë´. (ì •ë‹µ: ìƒíƒœí†µë¡œ)"); this.resetBridge(); }
            },
            checkAction: function(type) {
                if(type === 4) {
                    document.getElementById('raccoon-status').classList.add('green');
                    document.getElementById('raccoon-status').innerText = "ğŸ˜‡";
                    GameUI.modal("ë”©ë™ëŒ•! ë’·ê±¸ìŒì§ˆ ì³ì„œ ê±°ë¦¬ë¥¼ ë‘¡ë‹ˆë‹¤."); SceneManager.next('ep2', 5);
                } else { GameUI.modal("ì‚-! ê²½ê³ ! ë„ˆêµ¬ë¦¬ê°€ ë†€ë¼ìš”."); document.getElementById('section-ep2').classList.add('shake'); setTimeout(()=>document.getElementById('section-ep2').classList.remove('shake'),400); }
            },
            checkMath: function() {
                if(document.getElementById('ep2-input-math').value == '4') { GameUI.modal('ë ë§~! ì •ë‹µ!'); SceneManager.next('ep2', 6); }
                else document.getElementById('ep2-hint-math').style.display = 'block';
            }
        };

        // EP3 ë”±ë”°êµ¬ë¦¬
        const Ep3Game = {
            sequence: [], userSequence: [], isUserTurn: false,
            resetGame: function() {
                 this.sequence = []; this.userSequence = []; this.isUserTurn = false;
                 document.getElementById('rhythm-status').innerText = "[ì‹œì‘] ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”";
                 document.getElementById('rhythm-start-btn').disabled = false;
            },
            startGame: function() {
                document.getElementById('rhythm-start-btn').disabled = true;
                document.getElementById('rhythm-status').innerText = "ì˜ ë³´ì„¸ìš”...";
                this.sequence = []; this.userSequence = [];
                for(let i=0; i<5; i++) this.sequence.push(Math.floor(Math.random() * 16) + 1); // 5ê°œ ëœë¤ (ìˆ˜ì •ë¨)
                this.playSequence();
            },
            playSequence: function() {
                let i = 0;
                let interval = setInterval(() => {
                    if (i >= this.sequence.length) {
                        clearInterval(interval); this.isUserTurn = true;
                        document.getElementById('rhythm-status').innerText = "ìˆœì„œëŒ€ë¡œ ëˆ„ë¥´ì„¸ìš”!";
                        document.getElementById('rhythm-status').style.color = "#00ff9d"; return;
                    }
                    this.highlightHole(this.sequence[i]); i++;
                }, 800); // ì†ë„ ëŠë¦¬ê²Œ (800ms)
            },
            highlightHole: function(num) {
                let hole = document.getElementById('hole-' + num);
                hole.classList.add('active'); setTimeout(() => hole.classList.remove('active'), 400);
            },
            userClick: function(num) {
                if (!this.isUserTurn) return;
                this.highlightHole(num); this.userSequence.push(num);
                let idx = this.userSequence.length - 1;
                if (this.userSequence[idx] !== this.sequence[idx]) {
                    document.getElementById('rhythm-status').innerText = "í‹€ë ¸ì–´! ë‹¤ì‹œ ì‹œì‘í•´ë´.";
                    document.getElementById('rhythm-status').style.color = "#ff6b6b";
                    this.isUserTurn = false;
                    document.getElementById('rhythm-start-btn').disabled = false;
                    document.getElementById('rhythm-start-btn').innerText = "ë‹¤ì‹œ ë„ì „!";
                    return;
                }
                if (this.userSequence.length === this.sequence.length) {
                    this.isUserTurn = false; document.getElementById('rhythm-status').innerText = "ì„±ê³µ!";
                    setTimeout(() => { GameUI.modal("ëŒ€ë‹¨í•´! ë¦¬ë“¬ê°ì´ ì¢‹ì€ê±¸?"); SceneManager.next('ep3', 3); }, 500);
                }
            },
            checkCode: function() {
                if(document.getElementById('ep3-input-code').value.replace(/\s/g,'') === '625') {
                    GameUI.modal('ë ë§~! ì •ë‹µ! ì£½ì€ ë‚˜ë¬´ëŠ” ìˆ²ì˜ ë³´ë¬¼ì´ì•¼.'); SceneManager.next('ep3', 4);
                } else GameUI.modal('1~20ë²ˆ ì•”í˜¸í‘œë¥¼ ì˜ ë´. 6(ê³ )-2(ì‚¬)-5(ëª©)');
            },
            checkFriend: function() {
                if(document.getElementById('ep3-input-friend').value === 'í•˜ëŠ˜ë‹¤ëŒì¥') {
                    GameUI.modal('ë ë§~! ì •ë‹µ!'); SceneManager.next('ep3', 5);
                } else {
                    GameUI.modal('í‹€ë ¸ì–´. ë‹¤ì‹œ ìƒê°í•´ë´.');
                    document.getElementById('ep3-hint-friend').style.display = 'block'; // íŒíŠ¸ í‘œì‹œ
                }
            },
            checkKey: function() {
                const val = document.getElementById('ep3-input-key').value;
                if(val === 'í•µì‹¬ì¢…' || val === 'í‚¤ìŠ¤í†¤ìŠ¤í”¼ì‹œì¦ˆ') {
                    GameUI.modal('ë ë§~! ì •ë‹µ! ìˆ²ì˜ ê¸°ë‘¥ ê°™ì€ ì¡´ì¬ì•¼.'); SceneManager.next('ep3', 6);
                } else GameUI.modal('ì´ˆì„± íŒíŠ¸: ã… ã…… ã…ˆ');
            }
        };

        // EP4 ì‚µ
        const Ep4Game = {
            checkFeatures: function() {
                const checks = document.querySelectorAll('input[name="salk"]:checked');
                if(checks.length !== 2) return GameUI.modal('íŠ¹ì§• 2ê°œë¥¼ ì„ íƒí•´ì¤˜.');
                let isCorrect = true;
                checks.forEach(c => { if(c.value === 'x') isCorrect = false; });
                if(isCorrect) { GameUI.modal('ë ë§~! ì •í™•í•´! ê·€ ë’¤ í° ë°˜ì ì´ í¬ì¸íŠ¸ì•¼.'); SceneManager.next('ep4', 2); }
                else GameUI.modal('ë‹¤ì‹œ ê´€ì°°í•´ë´. ì‚µì€ ê¼¬ë¦¬ê°€ ë­‰íˆ­í•´.');
            },
            salkTop: 10,
            gameInterval: null,
            car1: { x: 400, speed: 3 }, // ìƒë‹¨ ì°¨ (ì˜¤->ì™¼)
            car2: { x: 0, speed: 4 },   // í•˜ë‹¨ ì°¨ (ì™¼->ì˜¤)

            initRoadGame: function() {
                this.salkTop = 10;
                this.car1.x = 400; 
                this.car2.x = 0;   
                this.updateSalkPos();
                this.gameLoop();
            },

            gameLoop: function() {
                clearInterval(this.gameInterval);
                this.gameInterval = setInterval(() => {
                    var c1 = document.getElementById('car1');
                    var c2 = document.getElementById('car2');
                    
                    // car1: ì˜¤ë¥¸ìª½ -> ì™¼ìª½
                    this.car1.x -= this.car1.speed;
                    if(this.car1.x < -60) this.car1.x = 500;
                    c1.style.left = this.car1.x + 'px';

                    // car2: ì™¼ìª½ -> ì˜¤ë¥¸ìª½
                    this.car2.x += this.car2.speed;
                    if(this.car2.x > 500) this.car2.x = -60;
                    c2.style.left = this.car2.x + 'px';

                    // ì¶©ëŒ ì²´í¬ (salkTop ë²”ìœ„ ë‚´ì¼ ë•Œ car.x í™•ì¸)
                    if(this.salkTop > 70 && this.salkTop < 130) {
                        // Car 1 (ìƒë‹¨)
                        if(this.car1.x > 200 && this.car1.x < 320) this.collision();
                    }
                    
                    if(this.salkTop > 230 && this.salkTop < 290) {
                        // Car 2 (í•˜ë‹¨)
                        if(this.car2.x > 200 && this.car2.x < 320) this.collision();
                    }

                    // ë„ì°©
                    if(this.salkTop > 330) {
                        clearInterval(this.gameInterval);
                        GameUI.modal("ì„±ê³µ! ì•ˆì „í•˜ê²Œ ê±´ë„œì–´.");
                        SceneManager.next('ep4', 4);
                    }
                }, 20);
            },

            updateSalkPos: function() {
                document.getElementById('player-salk').style.top = this.salkTop + 'px';
            },

            moveSalkClick: function() {
                this.salkTop += 20; // í´ë¦­ë‹¹ 20px ì´ë™
                this.updateSalkPos();
            },

            collision: function() {
                document.getElementById('road-msg').innerText = "ì¾…! ì¡°ì‹¬í•´!";
                this.salkTop = 10;
                this.updateSalkPos();
                setTimeout(() => { document.getElementById('road-msg').innerText = "ë‹¤ì‹œ ì‹œë„..."; }, 1000);
            },

            // --- M4 ë¨¹ì´ì‚¬ìŠ¬ ---
            selectedPiece: null,
            selectPiece: function(id) {
                document.querySelectorAll('.puzzle-piece').forEach(p => p.classList.remove('selected'));
                this.selectedPiece = id; document.getElementById('p-'+id).classList.add('selected');
            },
            placePiece: function(slotNum) {
                if(!this.selectedPiece) return GameUI.modal("ë¨¼ì € ì¡°ê°ì„ ì„ íƒí•˜ì„¸ìš”.");
                const correctMap = { 1:'grass', 2:'bug', 3:'mouse', 4:'bird', 5:'salk' };
                if(this.selectedPiece !== correctMap[slotNum]) return GameUI.modal("ì—¬ê¸°ê°€ ì•„ë‹Œ ê²ƒ ê°™ì•„. ë¨¹ì´ì‚¬ìŠ¬ ìˆœì„œë¥¼ ìƒê°í•´ë´!");
                
                const slot = document.getElementById('slot-'+slotNum);
                const pieceEl = document.getElementById('p-'+this.selectedPiece);
                slot.innerHTML = pieceEl.innerHTML; slot.classList.add('filled'); slot.dataset.filled = 'true';
                this.selectedPiece = null; pieceEl.style.visibility = 'hidden'; 
            },
            checkPuzzle: function() {
                let filled = 0; for(let i=1; i<=5; i++) if(document.getElementById('slot-'+i).dataset.filled) filled++;
                if(filled === 5) { GameUI.modal("ë ë§~! ì •ë‹µ! ìƒíƒœê³„ í”¼ë¼ë¯¸ë“œ ì™„ì„±!"); SceneManager.next('ep4', 5); }
                else GameUI.modal("ì•„ì§ ë¹ˆì¹¸ì´ ìˆì–´.");
            },
            checkFinal: function() {
                if(document.getElementById('ep4-input-final').value === 'ìƒë¬¼ë‹¤ì–‘ì„±') {
                    GameUI.modal('ë ë§~! ì •ë‹µ! ëª¨ë“  ìƒëª…ì€ ì—°ê²°ë˜ì–´ ìˆì–´.'); SceneManager.next('ep4', 6);
                } else GameUI.modal('íŒíŠ¸: ìƒíƒœê³„ì— ë‹¤ì–‘í•œ ìƒë¬¼ì´ í•¨ê»˜ ì‚¬ëŠ” ê²ƒì„ ë§í•´! (ã……ã…ã„·ã…‡ã……)'); // ì‰¬ìš´ ì„¤ëª…
            }
        };

        // ì—”ë”© í­ì£½
        const EndGame = {
            celebrate: function() {
                GameUI.modal("ğŸ‰ ê°•ë¶êµ¬ ìƒíƒœì§€í‚´ì´ê°€ ëœ ê²ƒì„ ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‰");
                document.getElementById('confetti-canvas').style.display = 'block';
                this.fireworks();
                setTimeout(() => location.reload(), 6000);
            },
            fireworks: function() {
                const canvas = document.getElementById('confetti-canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = window.innerWidth; canvas.height = window.innerHeight;
                const particles = [];
                // í­ì£½ ì´ëª¨í‹°ì½˜ ë°°ì—´
                const emojis = ['ğŸ‰', 'âœ¨', 'ğŸŒ¿', 'ğŸŒ¸', 'ğŸ¾'];
                
                for(let i=0; i<150; i++) {
                    particles.push({
                        x: Math.random()*canvas.width, y: Math.random()*canvas.height,
                        r: Math.random()*15+5, d: Math.random()*5+2, 
                        color: `hsl(${Math.random()*360}, 100%, 50%)`,
                        tilt: Math.floor(Math.random()*10)-10,
                        emoji: emojis[Math.floor(Math.random() * emojis.length)]
                    });
                }
                function draw() {
                    ctx.clearRect(0,0,canvas.width,canvas.height);
                    particles.forEach((p, i) => {
                        p.y += p.d; p.tilt += 1;
                        if(p.y > canvas.height) { p.y = -10; p.x = Math.random()*canvas.width; }
                        
                        ctx.font = p.r + "px Serif";
                        ctx.fillText(p.emoji, p.x + p.tilt, p.y);
                    });
                    requestAnimationFrame(draw);
                }
                draw();
            }
        };
    </script>
</body>
</html>